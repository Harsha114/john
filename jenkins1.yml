---
 - hosts: all
   gather_facts: no
   become: yes 
   tasks:
      - name: installing jenkins repo
        command: wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo
      - name: import jenkins ci key
        rpm_key:
          key: https://pkg.jenkins.io/redhat-stable/jenkins.io.key
          state: present
      - name: install jenkins
        yum: 
          name: jenkins
          state: installed
      - name: allow port 8080
        shell: iptables -I INPUT -p tcp --dport 8080 -m state --state NEW,ESTABLISHED -j ACCEPT
      - name: start the server
        service:
           name: jenkins
           state: started
#     - wait_for:
#         port: 8080
#         command: cat /var/lib/jenkins/secrets/initialAdminPassword
      - name: get admin password
        become: yes
        command: cat /var/lib/jenkins/secrets/initialAdminPassword
